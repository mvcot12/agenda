<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Agenda mensual · Mateo</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#fafafa;--card:#fff;--border:#ddd;--txt:#333;--muted:#666;
  --accent:#2ecc71;--neutra:#b2bec3;--baja:#9b59b6;--media:#f1c40f;
  --alta:#e67e22;--urgente:#e74c3c;
}
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--txt);
     display:flex;flex-direction:column;align-items:center;padding:1rem}
h1{font-size:1.75rem;font-weight:600;margin-bottom:1rem;text-align:center}
.container{width:100%;max-width:900px}

#searchBox{display:flex;justify-content:center;margin-bottom:1rem}
#googleInput{flex:1;max-width:360px;background:var(--card);border:1px solid var(--border);
  border-radius:999px;padding:.5rem 1rem;font-size:.95rem;color:var(--txt)}
#googleInput::placeholder{color:var(--muted)}

#calHeader{display:flex;justify-content:space-between;align-items:center;margin-bottom:.8rem}
.nav{background:none;border:none;font-size:1.4rem;color:var(--accent);cursor:pointer;font-weight:600}
#monthLabel{font-size:1.2rem;font-weight:600}
table{width:100%;border-collapse:collapse}
th,td{width:14.285%;height:90px;border:1px solid var(--border);background:var(--card);
      vertical-align:top;position:relative}
th{background:#f0f0f0;height:35px;font-size:.8rem;font-weight:600;color:var(--muted)}
td span.day{position:absolute;top:6px;left:6px;font-size:.8rem;font-weight:600}
.badge{position:absolute;top:4px;right:6px;background:var(--accent);color:#fff;
       border-radius:50%;font-size:.65rem;width:18px;height:18px;
       display:flex;align-items:center;justify-content:center}
.today{outline:3px solid var(--accent)}

#todayHeader{font-size:1.15rem;font-weight:600;margin:.9rem 0 .6rem}
.section{font-size:.9rem;font-weight:600;margin:.6rem 0 .3rem;color:var(--muted)}
.task{display:flex;align-items:center;gap:.7rem;background:var(--card);
      border-left:6px solid var(--neutra);border-radius:8px;padding:.6rem .8rem;
      margin-bottom:.5rem;box-shadow:0 1px 3px rgba(0,0,0,.07)}
[data-p="Baja"]{border-color:var(--baja)}
[data-p="Media"]{border-color:var(--media)}
[data-p="Alta"]{border-color:var(--alta)}
[data-p="Urgente"]{border-color:var(--urgente)}
.task.completed{opacity:.45;text-decoration:line-through}
.task span{flex:1;font-size:.9rem}
.task input{width:1.05rem;height:1.05rem;cursor:pointer}
.empty{opacity:.5;font-style:italic;padding:.5rem 0}

details{margin-top:1.2rem}
summary{cursor:pointer;font-weight:600;margin-bottom:.7rem}
form label{display:block;font-size:.83rem;margin:.35rem 0}
form input,form select{width:100%;padding:.4rem .5rem;font-size:.83rem;
  background:var(--card);border:1px solid var(--border);border-radius:6px;color:var(--txt)}
form input::placeholder{color:var(--muted)}
button{border:none;background:var(--accent);color:#fff;font-weight:600;
  padding:.5rem 1.2rem;border-radius:6px;margin-top:.8rem;cursor:pointer}
button:hover{opacity:.9}
</style>
</head>
<body>
  <h1>Agenda mensual · Mateo</h1>

  <!-- Buscador Google -->
  <form id="searchBox" action="https://www.google.com/search">
    <input id="googleInput" name="q" type="search" placeholder="Buscar en Google…">
  </form>

  <div class="container">
    <div id="calHeader">
      <button class="nav" id="prev">&#x276E;</button>
      <div id="monthLabel"></div>
      <button class="nav" id="next">&#x276F;</button>
    </div>
    <table id="calendar"></table>

    <h2 id="todayHeader"></h2>
    <div id="tasks"></div>

    <details>
      <summary>➕ Añadir pendiente</summary>
      <form id="addForm">
        <label>Fecha <input type="date" id="fDate" required></label>
        <label>Descripción <input type="text" id="fDesc" required></label>
        <label>Prioridad
          <select id="fPrio">
            <option>Neutra</option><option>Baja</option>
            <option>Media</option><option>Alta</option>
          </select>
        </label>
        <label>Hora (opcional) <input type="time" id="fTime"></label>
        <button>Guardar</button>
      </form>
    </details>
  </div>

  <script>
  /*— Helpers —*/
  const $ = id => document.getElementById(id);
  const dateISO = d => d.toISOString().slice(0,10);
  const parse   = s => new Date(s+"T00:00");
  const same    = (a,b) => dateISO(a)===dateISO(b);

  /*— Datos y constants —*/
  let tasks = JSON.parse(localStorage.getItem("agendaTasks")||"[]");
  let viewDate = new Date();
  const LEVELS = ["Neutra","Baja","Media","Alta","Urgente"];
  const ESC   = {Neutra:4,Baja:3,Media:2,Alta:1};

  /*— Guardar / cargar —*/
  function save() {
    localStorage.setItem("agendaTasks", JSON.stringify(tasks));
  }

  /*— Calendar —*/
  function buildCal(){
    const cal=$("calendar");
    cal.innerHTML="";
    const y=viewDate.getFullYear(), m=viewDate.getMonth();
    $("monthLabel").textContent = viewDate.toLocaleDateString("es-EC",{month:"long",year:"numeric"});
    const header = document.createElement("tr");
    ["lun","mar","mié","jue","vie","sáb","dom"].forEach(d=>{
      const th=document.createElement("th"); th.textContent=d; header.appendChild(th);
    });
    cal.appendChild(header);

    const offset=(new Date(y,m,1).getDay()+6)%7;
    const days=new Date(y,m+1,0).getDate();
    let row=document.createElement("tr");
    for(let i=0;i<offset;i++) row.appendChild(document.createElement("td"));
    for(let d=1; d<=days; d++){
      const day=new Date(y,m,d);
      const td=document.createElement("td");
      if(same(day,new Date())) td.classList.add("today");
      td.innerHTML=`<span class="day">${d}</span>`;
      const cnt=tasks.filter(t=>!t.done&&same(parse(t.date),day)).length;
      if(cnt){
        const b=document.createElement("div"); b.className="badge"; b.textContent=cnt; td.appendChild(b);
      }
      td.onclick=()=>{ viewDate=day; renderList(day); };
      row.appendChild(td);
      if((offset+d)%7===0||d===days){
        while(row.children.length<7) row.appendChild(document.createElement("td"));
        cal.appendChild(row);
        row=document.createElement("tr");
      }
    }
  }

  /*— Lista diaria —*/
  function taskEl(t, done, day){
    const div=document.createElement("div");
    div.className="task"+(done?" completed":"");
    div.dataset.p=t.priority;
    const chk=document.createElement("input");
    chk.type="checkbox"; chk.checked=done;
    chk.onchange=()=>toggleDone(t.id, day);
    const span=document.createElement("span");
    span.textContent=`[${t.priority}] ${t.desc}${t.time?` – ${t.time}`:""}`;
    div.append(chk,span);
    return div;
  }

  function renderList(date){
    $("todayHeader").textContent = date.toLocaleDateString("es-EC",{weekday:"long",day:"numeric",month:"long"});
    const box=$("tasks"); box.innerHTML="";
    const pend = tasks.filter(t=>!t.done&&same(parse(t.date),date));
    const comp = tasks.filter(t=> t.done&&same(parse(t.date),date));
    if(!pend.length && !comp.length){
      box.innerHTML='<div class="empty">Sin pendientes.</div>'; return;
    }
    pend.sort((a,b)=>LEVELS.indexOf(b.priority)-LEVELS.indexOf(a.priority))
        .forEach(t=>box.append(taskEl(t,false,date)));
    if(comp.length){
      box.insertAdjacentHTML("beforeend",'<div class="section">Completados</div>');
      comp.sort((a,b)=>b.id-a.id)
          .forEach(t=>box.append(taskEl(t,true,date)));
    }
  }

  /*— Escalar retrasadas —*/
  function escalate(){
    const today=parse(dateISO(new Date()));
    tasks.forEach(t=>{
      if(t.done) return;
      const d=parse(t.date);
      if(d<today){
        t.date=dateISO(today);
        const diff=(today-d)/86400000;
        const lim=ESC[t.priority];
        if(lim!==undefined && diff>=lim){
          const i=LEVELS.indexOf(t.priority);
          if(i<LEVELS.length-1) t.priority=LEVELS[i+1];
        }
      }
    });
  }

  /*— Acciones —*/
  function toggleDone(id, day){
    const t=tasks.find(x=>x.id===id);
    if(!t) return;
    t.done=!t.done;
    save(); buildCal(); renderList(day);
  }

  function addTask(e){
    e.preventDefault();
    if(!fDate.value||!fDesc.value.trim()) return;
    tasks.push({
      id:Date.now(), date:fDate.value,
      desc:fDesc.value.trim(),
      priority:fPrio.value,
      time:fTime.value,
      done:false
    });
    escalate(); save(); buildCal(); renderList(parse(fDate.value));
    e.target.reset(); e.target.parentElement.open=false;
  }

  /*— Init —*/
  window.onload = ()=>{
    escalate();
    buildCal();
    renderList(new Date());
    $("prev").onclick = ()=>{ viewDate.setMonth(viewDate.getMonth()-1); buildCal(); };
    $("next").onclick = ()=>{ viewDate.setMonth(viewDate.getMonth()+1); buildCal(); };
    $("addForm").addEventListener("submit", addTask);
    $("googleInput").focus();
  };
  </script>
</body>
</html>
