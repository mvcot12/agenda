<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Agenda diaria de Mateo</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
:root{
  --accent:#2ecc71;
  --bg:#fafafa;
  --card:#ffffff;
  --border:#e2e2e2;
  --txt:#333;
  --baja:#95a5a6;
  --media:#f1c40f;
  --alta:#e67e22;
  --urgente:#e74c3c;
}
*{box-sizing:border-box;margin:0;padding:0}
body{
  font-family:'Inter',Arial,Helvetica,sans-serif;
  background:var(--bg);
  color:var(--txt);
  display:flex;
  flex-direction:column;
  align-items:center;
  padding:1.5rem;
}
h1{font-size:1.6rem;font-weight:600;margin-bottom:1rem}
.container{width:100%;max-width:880px}
#week{
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:.5rem;
  margin-bottom:1.5rem;
}
.day{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:8px;
  padding:.6rem .4rem;
  text-align:center;
  font-size:.85rem;
  line-height:1.2;
  position:relative;
  transition:.2s;
}
.day.today{
  background:var(--accent);
  color:#fff;
  font-weight:600;
}
.day small{
  display:block;
  margin-top:.3rem;
  font-size:.7rem;
  opacity:.8;
}
#todayHeader{font-size:1.2rem;font-weight:600;margin-bottom:.75rem}
.task{
  display:flex;
  align-items:center;
  gap:.75rem;
  background:var(--card);
  border-left:6px solid var(--baja);
  border-radius:8px;
  padding:.7rem .9rem;
  margin-bottom:.5rem;
  box-shadow:0 2px 4px rgba(0,0,0,.04);
}
.task[data-priority="Media"]{border-color:var(--media)}
.task[data-priority="Alta"]{border-color:var(--alta)}
.task[data-priority="Urgente"]{border-color:var(--urgente)}
.task span{flex:1;font-size:.9rem}
.task input{width:1.1rem;height:1.1rem;cursor:pointer}
details{margin-top:1.75rem}
summary{cursor:pointer;font-weight:600;margin-bottom:.8rem}
form label{display:block;font-size:.85rem;margin:.4rem 0}
form input,form select{
  width:100%;padding:.45rem .5rem;font-size:.85rem;
  border:1px solid var(--border);border-radius:6px;
}
button{
  border:none;background:var(--accent);color:#fff;
  font-weight:600;padding:.5rem 1.1rem;border-radius:6px;
  margin-top:.9rem;cursor:pointer
}
button:hover{opacity:.92}
.empty{opacity:.6;font-style:italic;padding:.5rem 0}
</style>
</head>
<body>
<h1>Agenda diaria Â· Mateo</h1>
<div class="container">
  <div id="week"></div>
  <h2 id="todayHeader"></h2>
  <div id="tasks"></div>

  <details>
    <summary>âž• AÃ±adir pendiente</summary>
    <form id="addForm">
      <label>Fecha
        <input type="date" id="taskDate" required>
      </label>
      <label>Hora
        <input type="time" id="taskTime">
      </label>
      <label>DescripciÃ³n
        <input type="text" id="taskDesc" required placeholder="Ej. pagar maquilas">
      </label>
      <label>Prioridad
        <select id="taskPriority">
          <option value="Baja">Baja</option>
          <option value="Media">Media</option>
          <option value="Alta">Alta</option>
        </select>
      </label>
      <button type="submit">Guardar</button>
    </form>
  </details>
</div>

<script>
const STORAGE_KEY="agendaMateoTasks";
const levels=["Baja","Media","Alta","Urgente"];
const escalateDays={Baja:3,Media:2,Alta:1}; // dÃ­as p/ subir prioridad
let tasks=load()||[];

const parseYMD=str=>{
  const [y,m,d]=str.split("-").map(Number);
  return new Date(y, m-1, d); // fecha local, sin desfase
};
const todayLocal=new Date();

init();

function init(){
  renderWeek();
  escalate();
  renderToday();
  document.getElementById("addForm").addEventListener("submit",addTask);
}

function load(){
  try{return JSON.parse(localStorage.getItem(STORAGE_KEY));}
  catch{ return [];}
}
function save(){ localStorage.setItem(STORAGE_KEY,JSON.stringify(tasks)); }

function sameDate(a,b){
  return a.getFullYear()===b.getFullYear() &&
         a.getMonth()===b.getMonth() &&
         a.getDate()===b.getDate();
}

function startOfWeek(date){
  const d=new Date(date);
  const day=d.getDay(); // 0=Dom
  const diff=d.getDate()-day+(day===0?-6:1); // lunes
  return new Date(d.setDate(diff));
}

function renderWeek(){
  const wrap=document.getElementById("week");
  wrap.innerHTML="";
  const start=startOfWeek(todayLocal);
  for(let i=0;i<7;i++){
    const day=new Date(start);
    day.setDate(start.getDate()+i);
    const div=document.createElement("div");
    div.className="day"+(sameDate(day,todayLocal)?" today":"");
    div.textContent=day.toLocaleDateString("es-EC",{weekday:"short",day:"numeric",month:"short"});
    const count=tasks.filter(t=>sameDate(parseYMD(t.date),day)).length;
    if(count){
      const badge=document.createElement("small");
      badge.textContent=count+" tarea"+(count>1?"s":"");
      div.appendChild(badge);
    }
    wrap.appendChild(div);
  }
}

function renderToday(){
  document.getElementById("todayHeader").textContent=
    todayLocal.toLocaleDateString("es-EC",{weekday:"long",day:"numeric",month:"long"});
  const list=document.getElementById("tasks");
  list.innerHTML="";
  const todayTasks=tasks.filter(t=>sameDate(parseYMD(t.date),todayLocal));
  if(!todayTasks.length){
    list.innerHTML='<div class="empty">ðŸŽ‰ Sin pendientes hoy.</div>';
    return;
  }
  todayTasks.sort((a,b)=>levels.indexOf(b.priority)-levels.indexOf(a.priority));
  todayTasks.forEach(t=>{
    const div=document.createElement("div");
    div.className="task"; div.dataset.priority=t.priority;
    const chk=document.createElement("input");
    chk.type="checkbox";
    chk.addEventListener("change",()=>complete(t.id));
    const span=document.createElement("span");
    span.textContent=`[${t.priority}] ${t.time?t.time+" â€“ ":""}${t.desc}`;
    div.append(chk,span);
    list.appendChild(div);
  });
}

function addTask(e){
  e.preventDefault();
  const f=document.getElementById("taskDate").value;
  const h=document.getElementById("taskTime").value;
  const d=document.getElementById("taskDesc").value.trim();
  const p=document.getElementById("taskPriority").value;
  if(!f||!d)return;
  tasks.push({id:Date.now(),date:f,time:h,desc:d,priority:p});
  save();
  e.target.reset();
  renderWeek();
  renderToday();
  e.target.parentElement.open=false;
}

function complete(id){
  tasks=tasks.filter(t=>t.id!==id);
  save();
  renderWeek();
  renderToday();
}

function escalate(){
  tasks.forEach(t=>{
    const tDate=parseYMD(t.date);
    if(tDate<todayLocal){
      const diff=Math.floor((todayLocal - tDate)/86400000);
      t.date=todayLocal.toISOString().split("T")[0]; // mover a hoy
      const rule=escalateDays[t.priority];
      if(rule!=null && diff>=rule){
        const idx=levels.indexOf(t.priority);
        if(idx<levels.length-1) t.priority=levels[idx+1];
      }
    }
  });
  save();
}
</script>
</body>
</html>
